<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Load d3.js, v4 -->
    <script src="https://d3js.org/d3.v6.js"></script>
</head>
<style>
    .rects:hover {
        cursor: pointer;
    }

    .graphs {
        display: flex;
        flex-wrap: wrap;
    }

    /* add non-traditional graphs */
    /* add graph title */

    .dotsMeet:hover,
    .dotsBegin:hover,
    .dotsLive:hover,
    .dotsMarry:hover,
    .dotsSeparate:hover {
        stroke: black;
        stroke-width: 3px;
        cursor: pointer;
    }

    .vis2 {
        display: flex;
    }
</style>

<body>
    <script>
        // VISUALIZATION 1 CODE
        // set the dimensions and margins of the graph
        var margin_1 = { top: 20, right: 20, bottom: 60, left: 60 },
            width_1 = 460,
            height_1 = 110;

        // load and format the data
        d3.csv("./Vis1_Data.csv",
            function (d) {
                //console.log("data", d);
                return { method: d.Method, "Same-sex": d.same_sex, "Large age difference": d.large_age_diff, "Interracial": d.interracial, "All": d.all }
            }).then(
                function (data) {
                    const smallMultiple = d3.select("#meet");

                    const meetColumns = ["All", "Same-sex", "Large age difference", "Interracial"]
                    meetColumns.forEach(coupleType => {
                        drawBarChartMeet(smallMultiple, coupleType, data, "Title");
                    })
                }
            )

        drawBarChartMeet = function (container, coupleType, data, chartTitle) {
            // append the svg object to the body of the page
            var svg = container.append("svg");
            svg.attr("width", width_1 + margin_1.left + margin_1.right)
            svg.attr("height", height_1 + margin_1.top + margin_1.bottom)
            svg.append("g")
                .attr("transform",
                    "translate(" + margin_1.left + "," + margin_1.top + ")");

                    
            // Add X axis
            const xScale = d3.scaleBand()
                .domain(data.map(d => d.method))
                .range([0, width_1])
                .padding(0.2);

            svg.append("g")
                .attr("transform", "translate(0," + height_1 + ")")
                .call(d3.axisBottom(xScale))
                .selectAll("text")
                .attr("y", 10)
                .attr("x", 9)
                .attr("dy", ".35em")
                .attr("transform", "rotate(30)")
                .style("text-anchor", "start");

            // Add Y axis
            const yScale = d3.scaleLinear()
                .domain([0, 0.35])
                .range([height_1, 0]);

            svg.append("g")
                .call(d3.axisLeft(yScale))

            // add small multiple title
            svg.append("text")
                .attr("x", width_1 / 2)
                .attr("y", 12)
                .attr("text-anchor", "middle")
                .text(coupleType);

            // add x-axis title
            // svg.append("text")
            //     .attr("x", width_1 / 2)
            //     .attr("y", height_1 - 5)
            //     .attr("text-anchor", "middle")
            //     .attr("font-size", "14px")
            //     .text("Year");

            // // add y-axis title, remember that all transformations are around the (0, 0) origin
            // svg.append("text")
            //     .attr("x", -(margin_1.top + height_1 / 2))
            //     .attr("y", 15)
            //     .attr("transform", "rotate(-90)")  // rotate it by -90 degrees
            //     .attr("text-anchor", "middle")
            //     .attr("font-size", "14px")
            //     .text("Proportion")

            // Add bars 
            const barGroup = svg.append("g") // create a group to keep the bars
                .attr("class", "barGroup")
                .attr("transform", `translate(${0}, ${0})`); // shift all bars by the margin offset

                const showTooltip = function(event, d) {
                tooltip
                .transition()
                .duration(200)
                tooltip
                .style("opacity", 1)
                .html("Freq: " + Math.round(d[coupleType] * 100) / 100)
                .style("left", (event.x)+10 + "px")
                .style("top", (event.y)+10 + "px")
            }

            const moveTooltip = function(event, d) {
                tooltip
                .style("left", (event.x)+10 + "px")
                .style("top", (event.y)+10 + "px")
            }

            const hideTooltip = function(event, d) {
                tooltip
                .transition()
                .duration(200)
                .style("opacity", 0)
            }
            // Add rectangles here by binding the totalPopDataEntries array with rect elements
            barGroup.selectAll("rect")
                .data(data)
                .join("rect")
                .attr("class", "path")
                .attr("class", d => d.method)
                .attr("x", d => xScale(d.method))
                .attr("fill", "#B3B1EF")
                .attr("y", d => yScale(d[coupleType]))
                .attr("width", xScale.bandwidth())
                .attr("height", d => height_1 - yScale(d[coupleType] + 20))
                .on("mouseover", showTooltip)
                .on("mousemove", moveTooltip)
                .on("mouseout", hideTooltip)
                 // create a tooltip div that is hidden by default:
            const tooltip = d3.select("#milestoneAge")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "black")
                .style("border-radius", "5px")
                .style("padding", "10px")
                .style("color", "white")
                .style("position", "absolute")

            /****** Tooltip Code ******/
            const tooltipGroup = svg.append("g")
                .attr("id", "tooltip")
                .style("display", "none")
                .append("text")
                .attr("id", "tooltip-text")
                .attr("x", 5)
                .attr("y", 15)
                .attr("font-size", "12px")
                .attr("font-weight", "bold")
                .attr("fill", "black");
        
        }


    </script>
    <!-- Visualization 2 -->
    <div class="vis2">
        <div class="graphs">
            <div id="meet"></div>
            <div id="milestone"></div>
            <div id="milestoneInter"></div>
            <div id="milestoneSame"></div>
            <div id="milestoneAge"></div>
        </div>
        <div>
            <svg id="mylegend" height=300 width=450></svg>
        </div>

    </div>



    <script src="./vis2all.js"></script>
    <script src="./vis2inter.js"></script>
    <script src="./vis2same.js"></script>
    <script src="./vis2age.js"></script>

</body>

</html>